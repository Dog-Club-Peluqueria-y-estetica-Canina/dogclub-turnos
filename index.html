<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dog Club - Peluquer√≠a y Est√©tica Canina</title>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Choices.js -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --turquesa: #26c6da;
      --turquesa-oscuro: #1fa3b7;
      --blanco: #ffffff;
      --texto: #222;
      --max-width: 980px;
    }
    body{
      margin:0;
      font-family: "Poppins", Arial, sans-serif;
      background-color: #f0fbfc;
      background-image: radial-gradient(rgba(38,198,218,0.08) 1px, transparent 1px),
                        radial-gradient(rgba(38,198,218,0.08) 1px, transparent 1px);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      color: var(--texto);
    }
    .wrap{ max-width: var(--max-width); margin: 30px auto; padding: 18px; }
    .card{ background: var(--blanco); border-radius: 16px; box-shadow: 0 8px 30px rgba(8, 40, 50, 0.08); padding: 24px; transition: all 0.4s ease; animation: fadeIn 0.8s ease; }

    .brand { display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; margin-bottom:20px; gap:10px;}
    .brand img{ display:block; width:auto; height:auto; max-width:500px; max-height:500px; object-fit:contain; background:transparent; }
    @media(max-width:720px){ .brand img{ max-width:280px; max-height:280px; } }

    h3{ color: var(--turquesa-oscuro); border-left:5px solid var(--turquesa); padding-left:10px; }
    label{ display:block; margin-top:12px; font-weight:600; color:#333; }
    input, select, textarea{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d7e9ea; margin-top:6px; font-size:15px; transition: border 0.2s ease; }
    input:focus, select:focus, textarea:focus{ border-color: var(--turquesa); outline: none; box-shadow: 0 0 3px rgba(38,198,218,0.3); }

    .btn{ display:inline-flex; align-items:center; justify-content:center; background:var(--turquesa); color:#fff; border:none; padding:12px 16px; border-radius:10px; font-weight:700; cursor:pointer; margin-top:18px; gap:8px; font-size:15px; transition: all 0.3s ease; }
    .btn:hover{ background:var(--turquesa-oscuro); transform: translateY(-2px); box-shadow:0 6px 15px rgba(38,198,218,0.25);}

    #calendar{ max-width:780px; margin:20px auto; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.05); overflow:hidden; }
    .turno-btns{ display:flex; justify-content:center; gap:20px; margin-top:15px; animation: fadeIn 0.4s ease; }
    .turno-btns button{ background:var(--turquesa); color:white; border:none; padding:14px 24px; border-radius:12px; cursor:pointer; font-weight:bold; transition:0.2s; font-size:16px; }
    .turno-btns button:hover{ background:#1fa3b7; transform: scale(1.05); }

    .cupos-info {
      background: #e0f7fa;
      border: 1px solid #b2ebf2;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      margin: 15px auto 0 auto;
      max-width: 400px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: none;
    }

    footer { background-color: #ffffff; border-top: 3px solid var(--turquesa); display: flex; justify-content: space-between; align-items: stretch; padding: 20px; flex-wrap: wrap; gap: 20px; margin-top: 40px; }
    footer iframe { border: none; border-radius: 12px; width: 48%; height: 250px; }
    footer .contacto { width: 48%; display: flex; flex-direction: column; justify-content: center; gap: 6px; font-size: 15px; }
    footer .contacto p { margin: 0; display: flex; align-items: center; gap: 8px; }

    @keyframes fadeIn{ from{ opacity:0; transform:translateY(10px);} to{ opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <img src="logo.png" alt="Dog Club Logo">
      </div>

      <!-- Paso 1 -->
      <div id="step1">
        <h3>Datos del cliente y mascota</h3>
        <form id="formStep1">
          <label for="nombreDueno">Nombre del due√±o *</label>
          <input id="nombreDueno" name="nombreDueno" type="text" maxlength="20" required>

          <label for="celular">Celular *</label>
          <input id="celular" name="celular" type="tel" maxlength="20" pattern="[0-9]{6,20}" required>

          <label for="nombreMascota">Nombre de la mascota *</label>
          <input id="nombreMascota" name="nombreMascota" type="text" maxlength="15" required>

          <label for="edad">Edad *</label>
          <input id="edad" name="edad" type="text" maxlength="3" pattern="[0-9]{1,3}" required>

          <label for="raza">Raza *</label>
          <select id="raza" name="raza" required></select>

          <div id="razaOtra" style="display:none; margin-top:8px;">
            <label for="otraRaza">Especific√° la raza *</label>
            <input id="otraRaza" name="otraRaza" type="text" maxlength="15">
          </div>

          <label for="tamano">Tama√±o *</label>
          <select id="tamano" name="tamano" required>
            <option value="">Seleccion√°</option>
            <option value="Grande">Grande</option>
            <option value="Mediano">Mediano</option>
            <option value="Peque√±o">Peque√±o</option>
          </select>

          <label>Tipo de servicio *</label>
          <div>
            <label><input type="checkbox" name="servicio" value="Ba√±o"> üßº Ba√±o</label>
            <label><input type="checkbox" name="servicio" value="Corte"> ‚úÇÔ∏è Corte</label>
          </div>

          <label>¬øTiene alg√∫n problema de salud o alergia?</label>
          <div>
            <label><input type="radio" name="saludAlergia" value="No" checked> No</label>
            <label><input type="radio" name="saludAlergia" value="Si"> S√≠</label>
          </div>

          <div id="campoSaludAlergia" style="display:none;">
            <label for="descripcionSaludAlergia">Describ√≠ brevemente</label>
            <input id="descripcionSaludAlergia" name="descripcionSaludAlergia" type="text" maxlength="25">
          </div>

          <button type="submit" class="btn" id="toStep2">Siguiente ‚Äî Elegir fecha üóìÔ∏è</button>
        </form>
      </div>

      <!-- Paso 2 -->
      <div id="step2" style="display:none;">
        <h3>Seleccion√° un d√≠a y turno disponible üóìÔ∏è</h3>
        <p>Hora de ingreso: ma√±ana (09:00) o tarde (13:00).</p>
        <div id="calendar"></div>
        <div id="cuposInfo" class="cupos-info" aria-live="polite"></div>
        <div class="turno-btns" id="turnoBtns" style="display:none;">
          <button id="turnoManana">üåû Turno Ma√±ana</button>
          <button id="turnoTarde">üåá Turno Tarde</button>
        </div>
        <button class="btn secondary" id="volverPaso1">‚¨ÖÔ∏è Volver</button>
      </div>

      <!-- Paso 3 -->
      <div id="step3" style="display:none;">
        <h3>Datos para transferencia üí≥</h3>
        <p>Abon√° la se√±a de $5000 por transferencia (CBU o alias en QR).</p>
        <img src="qr.png" alt="C√≥digo QR de pago" width="200">
      </div>
    </div>
  </div>

  <script>
    document.querySelectorAll('input[name="saludAlergia"]').forEach(radio => {
      radio.addEventListener('change', e => {
        document.getElementById('campoSaludAlergia').style.display = (e.target.value === 'Si') ? 'block' : 'none';
      });
    });

    const razasArray = ["Caniche","Labrador Retriever","Golden Retriever","Beagle","Otro"];
    razasArray.forEach(r => {
      const opt = document.createElement('option');
      opt.value = r;
      opt.textContent = r;
      document.getElementById('raza').appendChild(opt);
    });

    document.getElementById('raza').addEventListener('change', function(e){
      const v = e.target.value;
      document.getElementById('razaOtra').style.display = (v === 'Otro') ? 'block' : 'none';
    });

    document.getElementById('toStep2').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('step1').style.display = 'none';
      document.getElementById('step2').style.display = 'block';
      if (!window.calendarInitialized) initCalendar();
    });

    document.getElementById('volverPaso1').addEventListener('click', () => {
      document.getElementById('step2').style.display = 'none';
      document.getElementById('step1').style.display = 'block';
      document.getElementById('cuposInfo').style.display = 'none';
      document.getElementById('turnoBtns').style.display = 'none';
    });

    function initCalendar() {
      const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        selectable: true,
        editable: false,
        headerToolbar: { left: 'prev,next today', center: 'title', right: '' },
        validRange: { start: new Date().toISOString().split('T')[0] },
        dateClick: async function(info) {
          const fecha = info.dateStr;
          const cuposInfo = document.getElementById('cuposInfo');
          cuposInfo.style.display = 'block';
          cuposInfo.textContent = "‚è≥ Cargando disponibilidad...";

          try {
            const resp = await fetch(`https://script.google.com/macros/s/AKfycbx-qZl14ewHn0cCoaR7WQpmmiLlTiz-nE0sK2KcCR5_4YpQzBWkZD2qvYWjEYUHm6vvOg/exec?fecha=${fecha}`);
            const data = await resp.json();
            if (data.error) {
              cuposInfo.textContent = "‚ö†Ô∏è Error al obtener cupos.";
              return;
            }

            cuposInfo.textContent = `üìÖ ${fecha} ‚Äî Ma√±ana: ${data.turnoManana}/6 | Tarde: ${data.turnoTarde}/6`;

            document.getElementById('turnoBtns').style.display = 'flex';
            document.getElementById('turnoManana').onclick = () => enviarDatos(fecha, 'Ma√±ana');
            document.getElementById('turnoTarde').onclick = () => enviarDatos(fecha, 'Tarde');
          } catch (err) {
            console.error(err);
            cuposInfo.textContent = "‚ùå Error al conectar con el servidor.";
          }
        }
      });
      calendar.render();
      window.calendarInitialized = true;
    }

    function enviarDatos(fecha, turno) {
      const form = document.getElementById('formStep1');
      const datos = new FormData(form);
      datos.append('fecha', fecha);
      datos.append('turno', turno);

      fetch('https://script.google.com/macros/s/AKfycbx-qZl14ewHn0cCoaR7WQpmmiLlTiz-nE0sK2KcCR5_4YpQzBWkZD2qvYWjEYUHm6vvOg/exec', {
        method: 'POST',
        body: datos
      })
      .then(res => res.text())
      .then(() => {
        alert('‚úÖ Turno registrado correctamente.');
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'block';
      })
      .catch(() => alert('‚ùå Error al registrar el turno.'));
    }
  </script>
</body>
</html>
